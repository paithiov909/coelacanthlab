---
title: Rで言語処理100本ノックを解くわけがない（２）
author: paithiov909
date: "2020-06-11"
slug: 100-knocks-2020-2
categories: []
tags:
  - NLP
description: 'Rで言語処理100本ノック 2020（２）'
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<!--more-->
<div id="形態素解析" class="section level2">
<h2>形態素解析</h2>
<p>気をきかせて{readtext}で読みこんでおきます。</p>
<pre class="r"><code>temp &lt;- tempfile(fileext = &quot;.txt&quot;)
download.file(&quot;https://nlp100.github.io/data/neko.txt&quot;, temp)
neko &lt;- readtext::readtext(temp, encoding = &quot;UTF-8&quot;)
neko$text[1] %&gt;%
  readr::read_lines(skip_empty_rows = TRUE) %&gt;%
  length()
#&gt; [1] 9210</code></pre>
<div id="形態素解析結果の読み込み" class="section level3">
<h3>30. 形態素解析結果の読み込み</h3>
<p>{RMeCab}はtaggerをラップしていて必要な情報を取りづらいので、<a href="https://paithiov909.github.io/rjavacmecab/">オレオレパッケージ</a>を使います。動くはずです（ただし、{RMeCab}などに比べて5~10倍程度は遅い）。{RcppMeCab}でもできますが、公式のリポジトリのソースはWindows環境だとビルドにコケるのでUNIX系の環境が必要です（2020年5月現在）。</p>
<p>データフレームで持ちたいのですが、すべて変換すると死ぬほど時間がかかるのでここでは一部の解析結果だけ使います。</p>
<pre class="r"><code>neko_txt_mecab &lt;- rjavacmecab::cmecab(neko$text[1])[1:900] %&gt;%
  purrr::map_dfr(function(line) {
    row &lt;- stringr::str_split(line, &quot; &quot;, simplify = TRUE)
    attr &lt;- rjavacmecab::tokenize(row[1, 2]) %&gt;%
      t() %&gt;%
      as.data.frame(stringsAsFactors = FALSE)
    res &lt;- row[1, 1] %&gt;%
      as.data.frame(stringsAsFactors = FALSE) %&gt;%
      dplyr::bind_cols(attr)
    return(res)
  })
colnames(neko_txt_mecab) &lt;- c(
  &quot;Surface&quot;,
  &quot;POS1&quot;,
  &quot;POS2&quot;,
  &quot;POS3&quot;,
  &quot;POS4&quot;,
  &quot;X5StageUse1&quot;,
  &quot;X5StageUse2&quot;,
  &quot;Base&quot;,
  &quot;Reading&quot;,
  &quot;Pronunciation&quot;
)
head(neko_txt_mecab)
#&gt;   Surface   POS1   POS2 POS3 POS4 X5StageUse1 X5StageUse2 Base  Reading
#&gt; 1      一   名詞     数    *    *           *           *   一     イチ
#&gt; 2      　   記号   空白    *    *           *           *   　       　
#&gt; 3    吾輩   名詞 代名詞 一般    *           *           * 吾輩 ワガハイ
#&gt; 4      は   助詞 係助詞    *    *           *           *   は       ハ
#&gt; 5      猫   名詞   一般    *    *           *           *   猫     ネコ
#&gt; 6      で 助動詞      *    *    *    特殊・ダ      連用形   だ       デ
#&gt;   Pronunciation
#&gt; 1          イチ
#&gt; 2            　
#&gt; 3      ワガハイ
#&gt; 4            ワ
#&gt; 5          ネコ
#&gt; 6            デ</code></pre>
</div>
<div id="動詞" class="section level3">
<h3>31. 動詞</h3>
<pre class="r"><code>neko_txt_mecab %&gt;%
  dplyr::filter(POS1 == &quot;動詞&quot;) %&gt;%
  dplyr::select(Surface) %&gt;%
  head()
#&gt;   Surface
#&gt; 1    生れ
#&gt; 2    つか
#&gt; 3      し
#&gt; 4    泣い
#&gt; 5      し
#&gt; 6    いる</code></pre>
</div>
<div id="動詞の原形" class="section level3">
<h3>32. 動詞の原形</h3>
<pre class="r"><code>neko_txt_mecab %&gt;%
  dplyr::filter(POS1 == &quot;動詞&quot;) %&gt;%
  dplyr::select(Base) %&gt;%
  head()
#&gt;     Base
#&gt; 1 生れる
#&gt; 2   つく
#&gt; 3   する
#&gt; 4   泣く
#&gt; 5   する
#&gt; 6   いる</code></pre>
</div>
<div id="aのb" class="section level3">
<h3>33. 「AのB」</h3>
<pre class="r"><code>neko_txt_mecab %&gt;%
  tibble::rowid_to_column() %&gt;%
  dplyr::filter(Surface == &quot;の&quot;) %&gt;%
  dplyr::pull(rowid) %&gt;%
  purrr::keep(~ neko_txt_mecab$POS1[. - 1] == &quot;名詞&quot; &amp;&amp; neko_txt_mecab$POS1[. + 1] == &quot;名詞&quot;) %&gt;%
  purrr::map_chr(~ stringr::str_c(
    neko_txt_mecab$Surface[. - 1],
    neko_txt_mecab$Surface[.],
    neko_txt_mecab$Surface[. + 1],
    collapse = &quot;&quot;
  ))
#&gt;  [1] &quot;彼の掌&quot;     &quot;掌の上&quot;     &quot;書生の顔&quot;   &quot;はずの顔&quot;   &quot;顔の真中&quot;  
#&gt;  [6] &quot;穴の中&quot;     &quot;書生の掌&quot;   &quot;掌の裏&quot;     &quot;何の事&quot;     &quot;肝心の母親&quot;
#&gt; [11] &quot;藁の上&quot;     &quot;笹原の中&quot;   &quot;池の前&quot;     &quot;池の上&quot;     &quot;一樹の蔭&quot;  
#&gt; [16] &quot;垣根の穴&quot;   &quot;隣家の三&quot;   &quot;時の通路&quot;   &quot;一刻の猶予&quot; &quot;家の内&quot;    
#&gt; [21] &quot;彼の書生&quot;   &quot;以外の人間&quot; &quot;前の書生&quot;</code></pre>
</div>
<div id="名詞の連接" class="section level3">
<h3>34. 名詞の連接</h3>
<p>（これよくわからない）</p>
<pre class="r"><code>idx &lt;- neko_txt_mecab %&gt;%
  tibble::rowid_to_column() %&gt;%
  dplyr::filter(POS1 == &quot;名詞&quot;) %&gt;%
  dplyr::pull(rowid) %&gt;%
  purrr::discard(~ neko_txt_mecab$POS1[. + 1] != &quot;名詞&quot;)

search_in &lt;- idx

purrr::map_chr(search_in, function(idx) {
  itr &lt;- idx
  res &lt;- stringr::str_c(neko_txt_mecab$Surface[idx])
  while (neko_txt_mecab$POS1[itr + 1] == &quot;名詞&quot;) {
    res &lt;- stringr::str_c(res, neko_txt_mecab$Surface[itr + 1])
    search_in &lt;&lt;- purrr::discard(search_in, ~ . == itr + 1)
    itr &lt;- itr + 1
  }
  return(res)
})
#&gt;  [1] &quot;人間中&quot;       &quot;一番獰悪&quot;     &quot;時妙&quot;         &quot;一毛&quot;         &quot;その後猫&quot;    
#&gt;  [6] &quot;一度&quot;         &quot;ぷうぷうと煙&quot; &quot;邸内&quot;         &quot;三毛&quot;         &quot;書生以外&quot;</code></pre>
</div>
<div id="単語の出現頻度" class="section level3">
<h3>35. 単語の出現頻度</h3>
<pre class="r"><code>neko_txt_mecab %&gt;%
  dplyr::group_by(Base) %&gt;%
  dplyr::count(Base, sort = TRUE) %&gt;%
  head()
#&gt; # A tibble: 6 x 2
#&gt; # Groups:   Base [6]
#&gt;   Base      n
#&gt;   &lt;chr&gt; &lt;int&gt;
#&gt; 1 。       51
#&gt; 2 た       40
#&gt; 3 て       39
#&gt; 4 の       39
#&gt; 5 が       35
#&gt; 6 だ       27</code></pre>
</div>
<div id="頻度上位10語" class="section level3">
<h3>36. 頻度上位10語</h3>
<pre class="r"><code>neko_txt_mecab %&gt;%
  dplyr::group_by(Base) %&gt;%
  dplyr::count(Base, sort = TRUE) %&gt;%
  head(10) %&gt;%
  ggplot(aes(x = reorder(Base, -n), y = n)) +
  geom_col() +
  labs(x = &quot;Surface form&quot;) +
  theme_light()</code></pre>
<p><img src="/posts/100-knocks-2020-2_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
</div>
<div id="猫と共起頻度の高い上位10語" class="section level3">
<h3>37. 「猫」と共起頻度の高い上位10語</h3>
<p>解釈のしかたが複数あるけれど、はじめに形態素解析する段階で文区切りを無視してしまったので、ここではbi-gramを数えてお茶をにごします。</p>
<pre class="r"><code>neko_txt_mecab %&gt;%
  tibble::rowid_to_column() %&gt;%
  dplyr::filter(Surface == &quot;猫&quot;) %&gt;%
  dplyr::mutate(Colocation = stringr::str_c(Surface, neko_txt_mecab$Surface[rowid + 1], sep = &quot; - &quot;)) %&gt;%
  dplyr::group_by(Colocation) %&gt;%
  dplyr::count(Colocation, sort = TRUE) %&gt;%
  head(10) %&gt;%
  ggplot(aes(x = reorder(Colocation, -n), y = n)) +
  geom_col() +
  labs(x = &quot;Colocation&quot;, y = &quot;Freq&quot;) +
  theme_light()</code></pre>
<p><img src="/posts/100-knocks-2020-2_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
</div>
<div id="ヒストグラム" class="section level3">
<h3>38. ヒストグラム</h3>
<pre class="r"><code>neko_txt_mecab %&gt;%
  dplyr::group_by(Base) %&gt;%
  dplyr::count(Base) %&gt;%
  ggplot(aes(x = reorder(Base, -n), y = n)) +
  geom_col() +
  labs(x = &quot;&quot;, y = &quot;Freq&quot;) +
  theme_light()</code></pre>
<p><img src="/posts/100-knocks-2020-2_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>
<div id="zipfの法則" class="section level3">
<h3>39. Zipfの法則</h3>
<p><del>ずっと雰囲気で書いている ggplot2なんもわからん</del></p>
<pre class="r"><code>count &lt;- neko_txt_mecab %&gt;%
  dplyr::group_by(Base) %&gt;%
  dplyr::count(Base) %&gt;%
  dplyr::ungroup()
count %&gt;%
  tibble::rowid_to_column() %&gt;%
  dplyr::mutate(rank = nrow(count) + 1 - dplyr::min_rank(count$n)[rowid]) %&gt;%
  ggplot(aes(x = rank, y = n)) +
  geom_point() +
  labs(x = &quot;Rank of Freq&quot;, y = &quot;Freq&quot;) +
  scale_x_log10() +
  scale_y_log10() +
  theme_light()</code></pre>
<p><img src="/posts/100-knocks-2020-2_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
</div>
</div>
<div id="セッション情報" class="section level2">
<h2>セッション情報</h2>
<pre class="r"><code>devtools::session_info()
#&gt; - Session info ---------------------------------------------------------------
#&gt;  setting  value                       
#&gt;  version  R version 3.6.3 (2020-02-29)
#&gt;  os       Windows 10 x64              
#&gt;  system   x86_64, mingw32             
#&gt;  ui       RTerm                       
#&gt;  language (EN)                        
#&gt;  collate  Japanese_Japan.932          
#&gt;  ctype    Japanese_Japan.932          
#&gt;  tz       Asia/Tokyo                  
#&gt;  date     2020-06-11                  
#&gt; 
#&gt; - Packages -------------------------------------------------------------------
#&gt;  ! package     * version date       lib source        
#&gt;    assertthat    0.2.1   2019-03-21 [1] CRAN (R 3.6.3)
#&gt;    backports     1.1.7   2020-05-13 [1] CRAN (R 3.6.3)
#&gt;    blob          1.2.1   2020-01-20 [1] CRAN (R 3.6.3)
#&gt;    blogdown      0.19    2020-05-22 [1] CRAN (R 3.6.3)
#&gt;    bookdown      0.19    2020-05-15 [1] CRAN (R 3.6.3)
#&gt;    broom         0.5.6   2020-04-20 [1] CRAN (R 3.6.3)
#&gt;    callr         3.4.3   2020-03-28 [1] CRAN (R 3.6.3)
#&gt;    cellranger    1.1.0   2016-07-27 [1] CRAN (R 3.6.3)
#&gt;    cli           2.0.2   2020-02-28 [1] CRAN (R 3.6.3)
#&gt;    colorspace    1.4-1   2019-03-18 [1] CRAN (R 3.6.3)
#&gt;    crayon        1.3.4   2017-09-16 [1] CRAN (R 3.6.3)
#&gt;    data.table    1.12.8  2019-12-09 [1] CRAN (R 3.6.3)
#&gt;    DBI           1.1.0   2019-12-15 [1] CRAN (R 3.6.3)
#&gt;    dbplyr        1.4.4   2020-05-27 [1] CRAN (R 3.6.3)
#&gt;    desc          1.2.0   2018-05-01 [1] CRAN (R 3.6.3)
#&gt;    devtools      2.3.0   2020-04-10 [1] CRAN (R 3.6.3)
#&gt;    digest        0.6.25  2020-02-23 [1] CRAN (R 3.6.3)
#&gt;    dplyr       * 1.0.0   2020-05-29 [1] CRAN (R 3.6.3)
#&gt;    ellipsis      0.3.1   2020-05-15 [1] CRAN (R 3.6.3)
#&gt;    evaluate      0.14    2019-05-28 [1] CRAN (R 3.6.3)
#&gt;    fansi         0.4.1   2020-01-08 [1] CRAN (R 3.6.3)
#&gt;    farver        2.0.3   2020-01-16 [1] CRAN (R 3.6.3)
#&gt;    forcats     * 0.5.0   2020-03-01 [1] CRAN (R 3.6.3)
#&gt;    fs            1.4.1   2020-04-04 [1] CRAN (R 3.6.3)
#&gt;    generics      0.0.2   2018-11-29 [1] CRAN (R 3.6.3)
#&gt;    ggplot2     * 3.3.1   2020-05-28 [1] CRAN (R 3.6.3)
#&gt;    glue          1.4.1   2020-05-13 [1] CRAN (R 3.6.3)
#&gt;    gtable        0.3.0   2019-03-25 [1] CRAN (R 3.6.3)
#&gt;    haven         2.3.1   2020-06-01 [1] CRAN (R 3.6.3)
#&gt;    hms           0.5.3   2020-01-08 [1] CRAN (R 3.6.3)
#&gt;    htmltools     0.4.0   2019-10-04 [1] CRAN (R 3.6.3)
#&gt;    httr          1.4.1   2019-08-05 [1] CRAN (R 3.6.3)
#&gt;    jsonlite      1.6.1   2020-02-02 [1] CRAN (R 3.6.3)
#&gt;    knitr         1.28    2020-02-06 [1] CRAN (R 3.6.3)
#&gt;    labeling      0.3     2014-08-23 [1] CRAN (R 3.6.0)
#&gt;    lattice       0.20-38 2018-11-04 [2] CRAN (R 3.6.3)
#&gt;    lifecycle     0.2.0   2020-03-06 [1] CRAN (R 3.6.3)
#&gt;    lubridate     1.7.9   2020-06-08 [1] CRAN (R 3.6.3)
#&gt;    magrittr      1.5     2014-11-22 [1] CRAN (R 3.6.3)
#&gt;    memoise       1.1.0   2017-04-21 [1] CRAN (R 3.6.3)
#&gt;    modelr        0.1.8   2020-05-19 [1] CRAN (R 3.6.3)
#&gt;    munsell       0.5.0   2018-06-12 [1] CRAN (R 3.6.3)
#&gt;    nlme          3.1-144 2020-02-06 [2] CRAN (R 3.6.3)
#&gt;    pillar        1.4.4   2020-05-05 [1] CRAN (R 3.6.3)
#&gt;    pkgbuild      1.0.8   2020-05-07 [1] CRAN (R 3.6.3)
#&gt;    pkgconfig     2.0.3   2019-09-22 [1] CRAN (R 3.6.3)
#&gt;    pkgload       1.1.0   2020-05-29 [1] CRAN (R 3.6.3)
#&gt;    prettyunits   1.1.1   2020-01-24 [1] CRAN (R 3.6.3)
#&gt;    processx      3.4.2   2020-02-09 [1] CRAN (R 3.6.3)
#&gt;    ps            1.3.3   2020-05-08 [1] CRAN (R 3.6.3)
#&gt;    purrr       * 0.3.4   2020-04-17 [1] CRAN (R 3.6.3)
#&gt;    R.cache       0.14.0  2019-12-06 [1] CRAN (R 3.6.3)
#&gt;    R.methodsS3   1.8.0   2020-02-14 [1] CRAN (R 3.6.2)
#&gt;    R.oo          1.23.0  2019-11-03 [1] CRAN (R 3.6.2)
#&gt;    R.utils       2.9.2   2019-12-08 [1] CRAN (R 3.6.3)
#&gt;    R6            2.4.1   2019-11-12 [1] CRAN (R 3.6.3)
#&gt;    Rcpp          1.0.4.6 2020-04-09 [1] CRAN (R 3.6.3)
#&gt;    readr       * 1.3.1   2018-12-21 [1] CRAN (R 3.6.3)
#&gt;    readtext      0.76    2020-03-04 [1] CRAN (R 3.6.3)
#&gt;    readxl        1.3.1   2019-03-13 [1] CRAN (R 3.6.3)
#&gt;    remotes       2.1.1   2020-02-15 [1] CRAN (R 3.6.3)
#&gt;    reprex        0.3.0   2019-05-16 [1] CRAN (R 3.6.3)
#&gt;  D rJava         0.9-12  2020-03-24 [1] CRAN (R 3.6.3)
#&gt;    rjavacmecab   0.1.5-1 2020-05-26 [1] local         
#&gt;    rlang         0.4.6   2020-05-02 [1] CRAN (R 3.6.3)
#&gt;    rmarkdown     2.2     2020-05-31 [1] CRAN (R 3.6.3)
#&gt;    rprojroot     1.3-2   2018-01-03 [1] CRAN (R 3.6.3)
#&gt;    rstudioapi    0.11    2020-02-07 [1] CRAN (R 3.6.3)
#&gt;    rvest         0.3.5   2019-11-08 [1] CRAN (R 3.6.3)
#&gt;    scales        1.1.1   2020-05-11 [1] CRAN (R 3.6.3)
#&gt;    sessioninfo   1.1.1   2018-11-05 [1] CRAN (R 3.6.3)
#&gt;    stringi       1.4.6   2020-02-17 [1] CRAN (R 3.6.2)
#&gt;    stringr     * 1.4.0   2019-02-10 [1] CRAN (R 3.6.3)
#&gt;    styler        1.3.2   2020-02-23 [1] CRAN (R 3.6.3)
#&gt;    testthat      2.3.2   2020-03-02 [1] CRAN (R 3.6.3)
#&gt;    tibble      * 3.0.1   2020-04-20 [1] CRAN (R 3.6.3)
#&gt;    tidyr       * 1.1.0   2020-05-20 [1] CRAN (R 3.6.3)
#&gt;    tidyselect    1.1.0   2020-05-11 [1] CRAN (R 3.6.3)
#&gt;    tidyverse   * 1.3.0   2019-11-21 [1] CRAN (R 3.6.3)
#&gt;    usethis       1.6.1   2020-04-29 [1] CRAN (R 3.6.3)
#&gt;    utf8          1.1.4   2018-05-24 [1] CRAN (R 3.6.3)
#&gt;    vctrs         0.3.1   2020-06-05 [1] CRAN (R 3.6.3)
#&gt;    withr         2.2.0   2020-04-20 [1] CRAN (R 3.6.3)
#&gt;    xfun          0.14    2020-05-20 [1] CRAN (R 3.6.3)
#&gt;    xml2          1.3.2   2020-04-23 [1] CRAN (R 3.6.3)
#&gt;    yaml          2.2.1   2020-02-01 [1] CRAN (R 3.6.3)
#&gt; 
#&gt; [1] C:/Users/user/Documents/R/win-library/3.6
#&gt; [2] C:/Program Files/R/R-3.6.3/library
#&gt; 
#&gt;  D -- DLL MD5 mismatch, broken installation.</code></pre>
</div>
